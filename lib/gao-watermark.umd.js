!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vue")):"function"==typeof define&&define.amd?define(["exports","vue"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["gao-watermark"]={},e.Vue)}(this,(function(e,t){"use strict";const o={color:"#ccc",fontSize:14,text:"watermark",rotate:45,gap:50},a=async e=>{let t={...o,...e},a=document.createElement("canvas"),n=a.getContext("2d");return await function(e,t,o){let a=o.fontSize*window.devicePixelRatio;t.font=`${a}px Arial`;let n=Array.isArray(o.text)?o.text:[o.text],r=Math.max(...n.map((e=>t.measureText(e).width))),i=r*Math.cos(Math.PI/4)+n.length*a,l=0,s=0;Array.isArray(o.gap)?(l=Math.min(i,r)+o.gap[0]*devicePixelRatio,s=Math.min(i,r)+o.gap[1]*devicePixelRatio):s=l=Math.min(i,r)+o.gap*devicePixelRatio;return e.width=l,e.height=s,t.translate(l/2,s/2),t.rotate(Math.PI/180*-o.rotate),t.fillStyle=o.color,t.font=`${a}px Arial`,t.textBaseline="middle",t.textAlign="center",n.forEach(((e,o)=>{let r=o-n.length/2+.5;t.fillText(e,0,r*a)})),Promise.resolve()}(a,n,t),Promise.resolve({base64:a.toDataURL(),size:{width:a.width,height:a.height}})};const n=t.defineComponent({__name:"water-mark",props:{text:{},fontSize:{},color:{},gap:{},zIndex:{},rotate:{},image:{}},setup(e){let o=t.getCurrentInstance();const n={fontSize:20,color:"rgba(0, 0, 0, .2)",text:"WaterMark",gap:50,rotate:45,zIndex:9999},r=e;let i=o.appContext.config.globalProperties._watermark_config||{},l={...n};Object.keys(r).forEach((e=>{const t=e,o=r[t],a=null==i?void 0:i[t],s=n[t];l[t]=void 0!==o?o:a??s}));const s=t.ref(null);let c="",d={width:0,height:0},u=null;const f=()=>{s.value&&(u&&u.remove(),u=document.createElement("div"),u.style.position="absolute",u.style.inset="0",u.style.pointerEvents="none",u.style.zIndex=String(l.zIndex),u.style.backgroundImage=`url(${c})`,u.style.backgroundSize=`${d.width}px ${d.height}px`,u.style.backgroundRepeat="repeat",s.value.appendChild(u))};let p=new MutationObserver((e=>{for(const t of e){for(const e of t.removedNodes)e===u&&f();t.target===u&&f()}}));return t.onMounted((async()=>{let e=await a(l);c=e.base64,d=e.size,f(),p.observe(s.value,{attributes:!0,childList:!0,subtree:!0})})),t.onUnmounted((()=>{p.disconnect()})),(e,o)=>(t.openBlock(),t.createElementBlock("div",{style:{position:"relative"},ref_key:"parentRef",ref:s},[t.renderSlot(e.$slots,"default")],512))}});e.GaoWatermark=n,e.default=(e,t)=>{e.config.globalProperties._watermark_config=t||{},e.component("GaoWatermark",n)},Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
